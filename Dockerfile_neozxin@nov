FROM busybox as stage-0_download
WORKDIR /downloads
RUN wget https://github.com/kasmtech/KasmVNC/releases/download/v1.3.1/kasmvncserver_focal_1.3.1_amd64.deb


FROM ubuntu:20.04
COPY --from=stage-0_download /downloads /src

WORKDIR /src

RUN apt update
RUN apt install -y sudo fluxbox xterm ./kasmvncserver_$(. /etc/os-release && echo "$VERSION_CODENAME")_1.3.1_amd64.deb

RUN groupadd -g 1234 xgroup && \
    useradd -m -u 1234 -g xgroup xuser
RUN adduser xuser ssl-cert

USER xuser

WORKDIR ~

COPY <<EOF .vnc/xstartup
#!/bin/sh
unset SESSION_MANAGER
unset DBUS_SESSION_BUS_ADDRESS
fluxbox
EOF
